version: '2'
services:
  grafana:
    image: grafana/grafana:5.4.0
    ports:
      - "60009:3000"
    environment:
      - GF_INSTALL_PLUGINS=grafana-simple-json-datasource, natel-plotly-panel
    cap_drop:
    - ALL
  sisock_crossbar:
    image: registry.spin.nersc.gov/bjk98/sisock_crossbar
    container_name: sisock_crossbar
    environment:
         - PYTHONUNBUFFERED=1
    cap_drop:
    - ALL
  sisock_grafana_http:
    image: registry.spin.nersc.gov/bjk98/sisock_grafana_http
    container_name: sisock_grafana_http
    depends_on:
      - "sisock_crossbar"
    cap_drop:
    - ALL
  weather_server:
    image: registry.spin.nersc.gov/bjk98/weather_server
    container_name: weather_server
    depends_on:
      - "sisock_crossbar"
      - "sisock_grafana_http"
    cap_drop:
    - ALL
#  radiometer_server:
#    image: "radiometer_server"
#    container_name: radiometer_server
#    build: ./components/data_node_servers/radiometer/
#    volumes:
#      - type: "bind"
#        source: "/var/www/Skymonitor"
#        target: "/data"
#        read_only: true
#    environment:
#        MAX_POINTS: 1000
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#  apex_weather_server:
#    image: "apex_weather_server"
#    container_name: apex_weather_server
#    build: ./components/data_node_servers/apex_weather/
#    volumes:
#      - type: "bind"
#        source: "/var/www/apex_weather"
#        target: "/data"
#        read_only: true
#    environment:
#        MAX_POINTS: 1000
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#  sensors_server:
#    image: "sensors_server"
#    container_name: sensors_server
#    build: ./components/data_node_servers/sensors/
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#  ls372_measurement:
#    image: "ls372_measurement"
#    container_name: ls372_measurement
#    build: ./components/data_node_servers/thermometry/
#    environment:
#        TARGET: measurement # match to instance-id of agent to monitor, used for data feed subscription
#        NAME: 'LSA22HA' # will appear in sisock a front of field name
#        DESCRIPTION: "LS372 measuring test board in the lab."
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#  ls372_control:
#    image: "ls372_control"
#    container_name: ls372_control
#    build: ./components/data_node_servers/thermometry/
#    environment:
#        TARGET: control # match to instance-id of agent to monitor, used for data feed subscription
#        NAME: 'LSA22YG' # will appear in sisock a front of field name
#        DESCRIPTION: "LS372 simulating control unit in the lab."
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#  ls240_monitor:
#    image: "ls240_monitor"
#    container_name: ls240_monitor
#    build: ./components/data_node_servers/thermometry/
#    environment:
#        TARGET: test240 # match to instance-id of agent to monitor, used for data feed subscription
#        NAME: 'LSA21OQ' # will appear in sisock a front of field name
#        DESCRIPTION: "LS240 unit in the lab."
#    depends_on:
#      - "sisock_crossbar"
#      - "sisock_grafana_http"
#
#networks:
#  default:
#    external:
#      name: sisock-net
